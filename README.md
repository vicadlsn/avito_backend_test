# Тестовое задание для стажёра Backend (осенняя волна 2025)

Репозиотрий содержит микросервис для автоматического назначения ревьюеров на Pull Request'ы (PR), а также управления командами и участниками. Взаимодействие происходит через HTTP API. Микросервис написан на Go 1.24, СУБД - PostgreSQL.

## Выполнено

-   Реализована вся основная логика.
-   Добавлен файл конфигурации линтера (golangci-lint).
-   Реализована безопасная деактивация пользователя.
-   Реализовано управление транзакциями на уровне бизнес-логики.
-   Написаны unit-тесты для сервисов.

## Запуск

Сервис запускается через Docker Compose:

```bash
make up
# или
docker-compose up --build
```

Сервис будет доступен на `http://localhost:8080`. Миграции применятся автоматически.

## Makefile команды

-   `make run` - запуск приложения локально
-   `make build` - сборка бинарника
-   `make test` - запуск тестов
-   `make lint` - проверка кода линтером
-   `make up` - запуск через docker-compose
-   `make down` - остановка контейнеров
-   `make logs` - просмотр логов приложения
-   `make migrate-up` - применение миграций
-   `make migrate-down` - откат последней миграции

## Структура проекта

```
avito_backend_test/
|- cmd/app/
|- internal/
| |- config/
| |- domain/
| |- repository/
| |- service/
| | |- pullrequest/
| | |- team/
| | |- user/
| |- transport/http/
|- migrations
|- pkg/db
```

## Вопросы по ТЗ и их решения

1. Можно ли создать команду с пустым списком участников?

    Решение: список участников не должен быть пустым, иначе команда не имеет смысла.

1. Что происходит при деактивации пользователя, который является ревьюером открытого PR?

    Решение: при деактивации пользователя система автоматически пытается найти замену из активных участников той же команды. Если подходящих кандидатов нет, ревьюер удаляется из списка ревьюеров PR.

## API

Полная спецификация API доступна в файле openapi.yml. Основные эндпоинты:

`POST /team/add`

Создание команды и её участников (создает/обновляет пользователей).

`GET /team/get`

Получение информации о команде с участниками.

`POST /users/setIsActive`

Установка флага активности пользователя. При деактивации ревьюера автоматически переназначается или удаляется из открытых PR.

`GET /users/getReview`

Получение списка PR, где пользователь назначен ревьюером.

`POST /pullRequest/create`

Создание PR и автоматическое назначение до двух активных ревьюеров из команды автора (исключая самого автора).

`POST /pullRequest/merge`

Идемпотентное закрытие PR.

`POST  /pullRequest/reassign`

Переназначение конкретного ревьюера на случайного активного участника его команды, если PR не находится в статусе `MERGED`.
